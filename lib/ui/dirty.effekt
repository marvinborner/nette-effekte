type Dirtiness { Clean(); Dirty() }

interface Redraw {
  def redrawCallee(): Unit
  def redrawFull(): Unit
}

def redraw[R] { callee: => Unit } { full: => Unit } { prog: => R / Redraw} =
  try prog()
  with Redraw {
    def redrawCallee() = resume(callee())
    def redrawFull() = resume(full())
  }